<view class="container">
  <view class="order-settlement">
    <view class="shop-info">
      <view class="info-detail">
        <text class="item-adress" wx:if="{{selected === '外送'}}">{{address}}</text>
        <text class="item-adress" wx:else>{{storeName}}</text>
        <text class="user-id" wx:if="{{selected === '外送'}}">{{phone}} {{username}}</text>

      </view>
      <view class="pickup-delivery-group">
        <navigator url="/subPackages/package/pages/ziti/ziti?type=jiesuan" class="pickup-button {{selected === '自提' ? 'active' : ''}}" bindtap="selectOption" data-option="自提">
          <text>自提</text>
        </navigator>
        <navigator url="/subPackages/package/pages/chooseLocation/chooseLocation?type=jiesuan" class="delivery-button {{selected === '外送' ? 'active' : ''}}" bindtap="selectOption" data-option="外送">
          <text>外送</text>
        </navigator>
      </view>
    </view>
    <view class="order-list">
      <view class="order-item" wx:for="{{items}}" wx:key="id">
        <view class="item">
          <image class="item-image" src="{{AUrl}}/jy/wxUserImg/106/{{item.img}}"></image>
          <view class="item-details">
            <text decode="true">{{item.title}}</text>
            <!-- <text class="item-description">{{item.desc}}</text> -->
            <text class="item-price">¥{{item.price}}</text>
            <text class="item-quantity">数量: {{item.num}}</text>
            <text class="item-customizations">定制选项：{{item.add}}</text>
          </view>
        </view>
      </view>
    </view>
    <view class="delivery-fee" style="position: relative;top: 20rpx;" wx:if="{{selected === '外送'}}">
      <text class="peisong" style="margin-left: 30rpx;">配送费 ¥5</text>
    </view>
    <view class=" total" style="position: relative;top: 30rpx; margin-bottom: 60rpx;">
      <text class="dai" style="margin-left: 30rpx;">待支付 ¥{{totalprice}}</text>
    </view>
    <!-- 新增：积分支付选项 -->
    <view class="points-option">
      <checkbox-group bindchange="checkboxChange">
        <label>
          <checkbox value="积分支付" checked="{{usePoints}}" />使用积分支付
        </label>
      </checkbox-group>
    </view>

    <view class="points-option">
      <checkbox-group bindchange="couponCheckboxChange">
        <label>
          <checkbox value="卡券支付" checked="{{useCoupon}}" />使用卡券支付
        </label>
      </checkbox-group>
      <view wx:if="{{!couponAvailable}}">
      </view>
    </view>
  </view>
  <view class="zhifu">
    <view class="pay-button" bindtap="initiatePayment">去支付</view>
  </view>

</view>

<!-- 交易码弹窗 -->
<!-- <view wx:if="{{showCodeDialog}}" class="code-dialog-mask" style="position: fixed; top:30%;transform: translateY(-50%); left:50%;transform: translateX(-50%); right:0; bottom:0;  z-index: 1;background-color: rgb(255, 255, 255); height: 350rpx; width: 90%;  box-shadow: -5px  -5rpx 10px 10px rgba(129, 128, 128, 0.2); border-radius: 20rpx;">
  <view class="title1">请输入六位数交易码</view>
  <view class="input-container">
    <block wx:for="{{inputBoxes}}" wx:key="index">
      <view class="input-box">
        -- input 输入框 --
        <input id="input-{{index}}" focus="false" type="number" value="{{item}}" data-index="{{index}}" disabled="true" maxlength="1" />
      </view>
      -- 蒙层 --
      <view class="overlay" bind:tap="handleGetFocus"></view>
    </block>
  </view>
  <input class="ipt" value="{{codeValue}}" focus="{{testFocus}}" type="number" bindinput="handleTestInput" maxlength="6" bind:tap="handleNotFocus" />
  <view class="dialog-buttons">
    <button class="dialog-btn cancel" bindtap="closeDialog">取消</button>
    <button class="dialog-btn confirm" bindtap="verifyCode">确认</button>
  </view>
</view> -->
<!-- <sqb-pay bindnavigateTo="navigateTo" return_url="/pages/payResult/index" total_amount="1" terminal_sn="tsn-100000330007352422" client_sn="{{ client_sn }}" subject="测试商品" subject_img="https://images.wosaimg.com/ba/a2b7c33c51258846fcc7bd8af95a12c093aa56.jpeg" merchant_name="测试商户" store_name="测试门店">
  <button>去支付</button>
</sqb-pay> -->


<!-- 新版交易码弹窗 -->
<view wx:if="{{showCodeDialog}}" class="code-dialog-mask">
  <view class="code-content">
    <view class="img">
      <image bindtap="closeDialog" src="{{tupianUrl}}/new/close.png" mode=""/>
    </view>
    <view class="title1">请输入交易码</view>
    <view class="input-container">
      <block wx:for="{{inputBoxes}}" wx:key="index">
        <view class="input-box">
          <!-- input 输入框 -->
          <input id="input-{{index}}" focus="false" type="number" value="{{item}}" data-index="{{index}}" disabled="true" maxlength="1" />
        </view>
        <view class="overlay" bind:tap="handleGetFocus"></view> <!-- 蒙层 -->
      </block>
    </view>
    <input class="ipt" value="{{codeValue}}" focus="{{testFocus}}" type="number" bindinput="handleTestInput" maxlength="6" bind:tap="handleNotFocus" />
    <view class="dialog-buttons">
      <view class="btn" bindtap="verifyCode">确定</view>
    </view>
  </view>
</view>
